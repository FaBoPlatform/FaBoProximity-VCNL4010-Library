#ifndef FABOPROXIMITY_VCNL4010_H
#define FABOPROXIMITY_VCNL4010_H

#include <Arduino.h>
#include <Wire.h>

#define VCNL4010_SLAVE_ADDRESS 0x13

#define VCNL4010_COMMAND 0x80
#define VCNL4010_ID 0x81
#define VCNL4010_PROX_RATE 0x82
#define VCNL4010_PROX_CURRENT 0x83
#define VCNL4010_AMBI_PARAMETER 0x84
#define VCNL4010_AMBI_VALUE 0x85
#define VCNL4010_PROX_VALUE 0x87
#define VCNL4010_INTERRUPT_CONTROL 0x89
#define VCNL4010_INTERRUPT_LOW_THRES 0x8A
#define VCNL4010_INTERRUPT_HIGH_THRES 0x8C
#define VCNL4010_INTERRUPT_STATUS 0x8E
#define VCNL4010_PROX_TIMING 0x8F

#define VCNL4010_COMMAND_ALL_DISABLE 0x00
#define VCNL4010_COMMAND_SELFTIMED_MODE_ENABLE 0x01
#define VCNL4010_COMMAND_PROX_ENABLE 0x02
#define VCNL4010_COMMAND_AMBI_ENABLE 0x04
#define VCNL4010_COMMAND_PROX_ON_DEMAND 0x08
#define VCNL4010_COMMAND_AMBI_ON_DEMAND 0x10
#define VCNL4010_COMMAND_MASK_PROX_DATA_READY 0x20
#define VCNL4010_COMMAND_MASK_AMBI_DATA_READY 0x40
#define VCNL4010_COMMAND_MASK_LOCK 0x80

#define VCNL4010_PROX_MEASUREMENT_RATE_2 0x00
#define VCNL4010_PROX_MEASUREMENT_RATE_4 0x01
#define VCNL4010_PROX_MEASUREMENT_RATE_8 0x02
#define VCNL4010_PROX_MEASUREMENT_RATE_16 0x03
#define VCNL4010_PROX_MEASUREMENT_RATE_31 0x04
#define VCNL4010_PROX_MEASUREMENT_RATE_62 0x05
#define VCNL4010_PROX_MEASUREMENT_RATE_125 0x06
#define VCNL4010_PROX_MEASUREMENT_RATE_250 0x07
#define VCNL4010_PROX_MASK_MEASUREMENT_RATE 0x07

#define VCNL4010_AMBI_PARA_AVERAGE_1 0x00
#define VCNL4010_AMBI_PARA_AVERAGE_2 0x01
#define VCNL4010_AMBI_PARA_AVERAGE_4 0x02
#define VCNL4010_AMBI_PARA_AVERAGE_8 0x03
#define VCNL4010_AMBI_PARA_AVERAGE_16 0x04
#define VCNL4010_AMBI_PARA_AVERAGE_32 0x05
#define VCNL4010_AMBI_PARA_AVERAGE_64 0x06
#define VCNL4010_AMBI_PARA_AVERAGE_128 0x07
#define VCNL4010_AMBI_MASK_PARA_AVERAGE 0x07
#define VCNL4010_AMBI_PARA_AUTO_OFFSET_ENABLE 0x08
#define VCNL4010_AMBI_MASK_PARA_AUTO_OFFSET 0x08
#define VCNL4010_AMBI_PARA_MEAS_RATE_1 0x00
#define VCNL4010_AMBI_PARA_MEAS_RATE_2 0x10
#define VCNL4010_AMBI_PARA_MEAS_RATE_3 0x20
#define VCNL4010_AMBI_PARA_MEAS_RATE_4 0x30
#define VCNL4010_AMBI_PARA_MEAS_RATE_5 0x40
#define VCNL4010_AMBI_PARA_MEAS_RATE_6 0x50
#define VCNL4010_AMBI_PARA_MEAS_RATE_8 0x60
#define VCNL4010_AMBI_PARA_MEAS_RATE_10 0x70
#define VCNL4010_AMBI_MASK_PARA_MEAS_RATE 0x70
#define VCNL4010_AMBI_PARA_CONT_CONV_ENABLE 0x80
#define VCNL4010_AMBI_MASK_PARA_CONT_CONV 0x80

#define VCNL4010_INTERRUPT_THRES_SEL_PROX 0x00
#define VCNL4010_INTERRUPT_THRES_SEL_ALS 0x01
#define VCNL4010_INTERRUPT_THRES_ENABLE 0x02
#define VCNL4010_INTERRUPT_ALS_READY_ENABLE 0x04
#define VCNL4010_INTERRUPT_PROX_READY_ENABLE 0x08
#define VCNL4010_INTERRUPT_COUNT_EXCEED_1 0x00
#define VCNL4010_INTERRUPT_COUNT_EXCEED_2 0x20
#define VCNL4010_INTERRUPT_COUNT_EXCEED_4 0x40
#define VCNL4010_INTERRUPT_COUNT_EXCEED_8 0x60
#define VCNL4010_INTERRUPT_COUNT_EXCEED_16 0x80
#define VCNL4010_INTERRUPT_COUNT_EXCEED_32 0xa0
#define VCNL4010_INTERRUPT_COUNT_EXCEED_64 0xc0
#define VCNL4010_INTERRUPT_COUNT_EXCEED_128 0xe0
#define VCNL4010_INTERRUPT_MASK_COUNT_EXCEED 0xe0
#define VCNL4010_INTERRUPT_STATUS_THRES_HI 0x01
#define VCNL4010_INTERRUPT_STATUS_THRES_LO 0x02
#define VCNL4010_INTERRUPT_STATUS_ALS_READY 0x04
#define VCNL4010_INTERRUPT_STATUS_PROX_READY 0x08
#define VCNL4010_INTERRUPT_MASK_STATUS_THRES_HI 0x01
#define VCNL4010_INTERRUPT_MASK_THRES_LO 0x02
#define VCNL4010_INTERRUPT_MASK_ALS_READY 0x04
#define VCNL4010_INTERRUPT_MASK_PROX_READY 0x08


class FaBoProximity {
  public:
    FaBoProximity(uint8_t addr = VCNL4010_SLAVE_ADDRESS);
    bool searchDevice(void);
    uint8_t readId();
    void configuration(void);
    void setCurrent(uint8_t current);
    uint8_t readCurrent();
    void setCommand(uint8_t command);
    uint8_t readCommand(void);
    void setProxRate(uint8_t rate);
    void setAmbiConfig(uint8_t config);
    bool isProxDataReady(void);
    bool isAmbiDataReady(void);
    uint16_t readProxValue(void);
    uint16_t readAmbiValue(void);
  private:
    uint8_t _i2caddr;
    uint8_t readI2c(uint8_t address);
    void writeI2c(uint8_t address, uint8_t data);
};

#endif // FABOPROXIMITY_VCNL4010_H
